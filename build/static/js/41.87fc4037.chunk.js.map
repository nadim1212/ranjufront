{"version":3,"sources":["pages/Checkout.js","functions/user.js"],"names":["Checkout","history","useState","products","setProducts","total","setTotal","address","setAddress","addressSaved","setAddressSaved","coupon","setCoupon","totalAfterDiscount","setTotalAfterDiscount","discountError","setDiscountError","dispatch","useDispatch","useSelector","state","user","COD","couponTrueOrFalse","useEffect","token","getUserCart","then","res","console","log","JSON","stringify","data","cartTotal","saveAddressToDb","saveUserAddress","ok","toast","success","applyDiscountCoupon","applyCoupon","type","payload","err","className","theme","value","onChange","onClick","e","target","length","map","p","i","key","product","title","color","count","price","disabled","createCashOrderForUser","window","localStorage","removeItem","emptyUserCart","setTimeout","push","userCart","cart","authtoken","a","axios","post","process","headers","get","delete","createOrder","stripeResponse","getUserOrders","getWishlist","removeWishlist","productId","put","addToWishlist","couponApplied"],"mappings":"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","file":"static/js/41.87fc4037.chunk.js","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { toast } from \"react-toastify\";\nimport {\n  getUserCart,\n  emptyUserCart,\n  saveUserAddress,\n  applyCoupon,\n  createCashOrderForUser,\n} from \"../functions/user\";\nimport ReactQuill from \"react-quill\";\nimport \"react-quill/dist/quill.snow.css\";\n\nconst Checkout = ({ history }) => {\n  const [products, setProducts] = useState([]);\n  const [total, setTotal] = useState(0);\n  const [address, setAddress] = useState(\"\");\n  const [addressSaved, setAddressSaved] = useState(false);\n  const [coupon, setCoupon] = useState(\"\");\n  // discount price\n  const [totalAfterDiscount, setTotalAfterDiscount] = useState(0);\n  const [discountError, setDiscountError] = useState(\"\");\n\n  const dispatch = useDispatch();\n  const { user, COD } = useSelector((state) => ({ ...state }));\n  const couponTrueOrFalse = useSelector((state) => state.coupon);\n\n  useEffect(() => {\n    if (user && user.token) {\n      getUserCart(user.token).then((res) => {\n        console.log(\"user cart res\", JSON.stringify(res.data, null, 4));\n        setProducts(res.data.products);\n        setTotal(res.data.cartTotal);\n      });\n    }\n  }, [user]);\n\n  const emptyCart = () => {\n    // remove from local storage\n    if (typeof window !== \"undefined\") {\n      localStorage.removeItem(\"cart\");\n    }\n    // remove from redux\n    dispatch({\n      type: \"ADD_TO_CART\",\n      payload: [],\n    });\n    // remove from backend\n    emptyUserCart(user.token).then((res) => {\n      setProducts([]);\n      setTotal(0);\n      setTotalAfterDiscount(0);\n      setCoupon(\"\");\n      toast.success(\"Cart is emapty. Contniue shopping.\");\n    });\n  };\n\n  const saveAddressToDb = () => {\n    // console.log(address);\n    saveUserAddress(user.token, address).then((res) => {\n      if (res.data.ok) {\n        setAddressSaved(true);\n        toast.success(\"Address saved\");\n      }\n    });\n  };\n\n  const applyDiscountCoupon = () => {\n    console.log(\"send coupon to backend\", coupon);\n    applyCoupon(user.token, coupon).then((res) => {\n      console.log(\"RES ON COUPON APPLIED\", res.data);\n      if (res.data) {\n        setTotalAfterDiscount(res.data);\n        // update redux coupon applied true/false\n        dispatch({\n          type: \"COUPON_APPLIED\",\n          payload: true,\n        });\n      }\n      // error\n      if (res.data.err) {\n        setDiscountError(res.data.err);\n        // update redux coupon applied true/false\n        dispatch({\n          type: \"COUPON_APPLIED\",\n          payload: false,\n        });\n      }\n    });\n  };\n\n  const showAddress = () => (\n    <>\n      <ReactQuill theme=\"snow\" value={address} onChange={setAddress} />\n      <button className=\"btn btn-primary mt-2\" onClick={saveAddressToDb}>\n        Save\n      </button>\n    </>\n  );\n\n  const showProductSummary = () =>\n    products.map((p, i) => (\n      <div key={i}>\n        <p>\n          {p.product.title} ({p.color}) x {p.count} ={\" \"}\n          {p.product.price * p.count}\n        </p>\n      </div>\n    ));\n\n  const showApplyCoupon = () => (\n    <>\n      <input\n        onChange={(e) => {\n          setCoupon(e.target.value);\n          setDiscountError(\"\");\n        }}\n        value={coupon}\n        type=\"text\"\n        className=\"form-control\"\n      />\n      <button onClick={applyDiscountCoupon} className=\"btn btn-primary mt-2\">\n        Apply\n      </button>\n    </>\n  );\n\n  const createCashOrder = () => {\n    createCashOrderForUser(user.token, COD, couponTrueOrFalse).then((res) => {\n      console.log(\"USER CASH ORDER CREATED RES \", res);\n      // empty cart form redux, local Storage, reset coupon, reset COD, redirect\n      if (res.data.ok) {\n        // empty local storage\n        if (typeof window !== \"undefined\") localStorage.removeItem(\"cart\");\n        // empty redux cart\n        dispatch({\n          type: \"ADD_TO_CART\",\n          payload: [],\n        });\n        // empty redux coupon\n        dispatch({\n          type: \"COUPON_APPLIED\",\n          payload: false,\n        });\n        // empty redux COD\n        dispatch({\n          type: \"COD\",\n          payload: false,\n        });\n        // mepty cart from backend\n        emptyUserCart(user.token);\n        // redirect\n        setTimeout(() => {\n          history.push(\"/user/history\");\n        }, 1000);\n      }\n    });\n  };\n\n  return (\n    <div className=\"row\">\n      <div className=\"col-md-6\">\n        <h4>Delivery Address</h4>\n        <br />\n        <br />\n        {showAddress()}\n        <hr />\n        <h4>Got Coupon?</h4>\n        <br />\n        {showApplyCoupon()}\n        <br />\n        {discountError && <p className=\"bg-danger p-2\">{discountError}</p>}\n      </div>\n\n      <div className=\"col-md-6\">\n        <h4>Order Summary</h4>\n        <hr />\n        <p>Products {products.length}</p>\n        <hr />\n        {showProductSummary()}\n        <hr />\n        <p>Cart Total: {total}</p>\n\n        {totalAfterDiscount > 0 && (\n          <p className=\"bg-success p-2\">\n            Discount Applied: Total Payable: ${totalAfterDiscount}\n          </p>\n        )}\n\n        <div className=\"row\">\n          <div className=\"col-md-6\">\n            {COD ? (\n              <button\n                className=\"btn btn-primary\"\n                disabled={!addressSaved || !products.length}\n                onClick={createCashOrder}\n              >\n                Place Order\n              </button>\n            ) : (\n              <button\n                className=\"btn btn-primary\"\n                disabled={!addressSaved || !products.length}\n                onClick={() => history.push(\"/payment\")}\n              >\n                Place Order\n              </button>\n            )}\n          </div>\n\n          <div className=\"col-md-6\">\n            <button\n              disabled={!products.length}\n              onClick={emptyCart}\n              className=\"btn btn-primary\"\n            >\n              Empty Cart\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Checkout;\n","import axios from \"axios\";\n\nexport const userCart = async (cart, authtoken) =>\n  await axios.post(\n    `${process.env.REACT_APP_API}/user/cart`,\n    { cart },\n    {\n      headers: {\n        authtoken,\n      },\n    }\n  );\n\nexport const getUserCart = async (authtoken) =>\n  await axios.get(`${process.env.REACT_APP_API}/user/cart`, {\n    headers: {\n      authtoken,\n    },\n  });\n\nexport const emptyUserCart = async (authtoken) =>\n  await axios.delete(`${process.env.REACT_APP_API}/user/cart`, {\n    headers: {\n      authtoken,\n    },\n  });\n\n// const saveAddressToDb = async (e) => {\n//   e.preventDefault();\n//   console.log(\n//     \"ADDRESS INPUT FROM USER ===> \",\n//     address,\n//     city,\n//     state,\n//     postalCode,\n//     country\n//   );\n\n//   const res = await axios.post(\n//     `http://localhost:8000/api/user/address`,\n//     { address, city, state, postalCode, country },\n//     {\n//       headers: {\n//         authtoken,\n//       },\n//     }\n//   );\n// };\n\nexport const saveUserAddress = async (authtoken, address) =>\n  await axios.post(\n    `${process.env.REACT_APP_API}/user/address`,\n    { address },\n    {\n      headers: {\n        authtoken,\n      },\n    }\n  );\n\nexport const applyCoupon = async (authtoken, coupon) =>\n  await axios.post(\n    `${process.env.REACT_APP_API}/user/cart/coupon`,\n    { coupon },\n    {\n      headers: {\n        authtoken,\n      },\n    }\n  );\n\nexport const createOrder = async (stripeResponse, authtoken) =>\n  await axios.post(\n    `${process.env.REACT_APP_API}/user/order`,\n    { stripeResponse },\n    {\n      headers: {\n        authtoken,\n      },\n    }\n  );\n\nexport const getUserOrders = async (authtoken) =>\n  await axios.get(`${process.env.REACT_APP_API}/user/orders`, {\n    headers: {\n      authtoken,\n    },\n  });\n\nexport const getWishlist = async (authtoken) =>\n  await axios.get(`${process.env.REACT_APP_API}/user/wishlist`, {\n    headers: {\n      authtoken,\n    },\n  });\n\nexport const removeWishlist = async (productId, authtoken) =>\n  await axios.put(\n    `${process.env.REACT_APP_API}/user/wishlist/${productId}`,\n    {},\n    {\n      headers: {\n        authtoken,\n      },\n    }\n  );\n\nexport const addToWishlist = async (productId, authtoken) =>\n  await axios.post(\n    `${process.env.REACT_APP_API}/user/wishlist`,\n    { productId },\n    {\n      headers: {\n        authtoken,\n      },\n    }\n  );\n\nexport const createCashOrderForUser = async (\n  authtoken,\n  COD,\n  couponTrueOrFalse\n) =>\n  await axios.post(\n    `${process.env.REACT_APP_API}/user/cash-order`,\n    { couponApplied: couponTrueOrFalse, COD },\n    {\n      headers: {\n        authtoken,\n      },\n    }\n  );\n"],"sourceRoot":""}